# DHCP Server Configuration for PXE Boot
# Managed by Ansible

default-lease-time {{ dhcp_lease_time }};
max-lease-time {{ dhcp_max_lease_time }};

option arch code 93 = unsigned integer 16;


authoritative;

# PXE Boot subnet
subnet {{ pxe_network }} netmask {{ pxe_netmask }} {
  range {{ dhcp_range_start }} {{ dhcp_range_end }};
  option routers {{ pxe_gateway }};
  option domain-name-servers {{ pxe_dns_servers | join(', ') }};
  option broadcast-address {{ pxe_network | regex_replace('\.0$', '.255') }};
  
  # PXE Boot configuration for UEFI
  next-server {{ pxe_server_ip }};
  
  # UEFI boot filename
  if exists user-class and option user-class = "iPXE" {
    filename "http://{{ pxe_server_ip }}/boot.ipxe";
  } elsif option arch = 00:07 or option arch = 00:09 {
    # UEFI x64 or UEFI x64 HTTP
    filename "bootx64.efi";
  } elsif option arch = 00:06 {
    # UEFI IA32
    filename "bootia32.efi";
  } else {
    # Legacy BIOS
    filename "pxelinux.0";
  }
}
