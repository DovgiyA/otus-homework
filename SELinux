AlmaLinux 9.6

[user@localhost ~]$ su root

[root@localhost user]# systemctl stop firewalld

[root@localhost user]# dnf install  setools-console

[root@localhost user]# dnf install policycoreutils-python-utils

[root@localhost user]# dnf install nginx

nano /etc/nginx/nginx.conf # добавляем нестандартный порт 92

[root@localhost user]# systemctl start nginx
Job for nginx.service failed because the control process exited with error code.
See "systemctl status nginx.service" and "journalctl -xeu nginx.service" for details.

Первый способ

grep 1761123003.336:150 /var/log/audit/audit.log | audit2why

[root@localhost user]# grep 1761123578.760:171 /var/log/audit/audit.log | audit2why
type=AVC msg=audit(1761123578.760:171): avc:  denied  { name_bind } for  pid=15897 comm="nginx" src=92 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:reserved_port_t:s0 tclass=tcp_socket permissive=0

	Was caused by:
		Missing type enforcement (TE) allow rule.

		You can use audit2allow to generate a loadable module to allow this access.

[root@localhost user]# setsebool -P nis_enabled on

[root@localhost user]# getsebool -a | grep nis_enabled
nis_enabled --> on

[root@localhost user]# systemctl restart nginx
[root@localhost user]# systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)
     Active: active (running) since Wed 2025-10-22 12:18:04 MSK; 8s ago
    Process: 16064 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 16065 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 16066 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 16067 (nginx)
      Tasks: 3 (limit: 10602)
     Memory: 2.8M
        CPU: 40ms
     CGroup: /system.slice/nginx.service
             ├─16067 "nginx: master process /usr/sbin/nginx"
             ├─16068 "nginx: worker process"
             └─16069 "nginx: worker process"

[root@localhost user]# setsebool -P nis_enabled off

Второй способ

[root@localhost user]# semanage port -l | grep http
http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010
http_cache_port_t              udp      3130
http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
pegasus_http_port_t            tcp      5988
pegasus_https_port_t           tcp      5989
[root@localhost user]# semanage port -a -t http_port_t -p tcp 92
[root@localhost user]# semanage port -l | grep http
http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010
http_cache_port_t              udp      3130
http_port_t                    tcp      92, 80, 81, 443, 488, 8008, 8009, 8443, 9000
pegasus_http_port_t            tcp      5988
pegasus_https_port_t           tcp      5989
[root@localhost user]# systemctl restart nginx
[root@localhost user]# systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)
     Active: active (running) since Wed 2025-10-22 12:18:04 MSK; 8s ago
    Process: 16064 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 16065 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 16066 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 16067 (nginx)
      Tasks: 3 (limit: 10602)
     Memory: 2.8M
        CPU: 40ms
     CGroup: /system.slice/nginx.service
             ├─16067 "nginx: master process /usr/sbin/nginx"
             ├─16068 "nginx: worker process"
             └─16069 "nginx: worker process"

Oct 22 12:18:04 localhost.localdomain systemd[1]: Starting The nginx HTTP and reverse proxy server...
Oct 22 12:18:04 localhost.localdomain nginx[16065]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Oct 22 12:18:04 localhost.localdomain nginx[16065]: nginx: configuration file /etc/nginx/nginx.conf test is successful
Oct 22 12:18:04 localhost.localdomain systemd[1]: Started The nginx HTTP and reverse proxy server.

[root@localhost user]# semanage port -d -t http_port_t -p tcp 92
[root@localhost user]# semanage port -l | grep  http_port_t
http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
pegasus_http_port_t            tcp      5988

Третий способ

[root@localhost user]# grep nginx /var/log/audit/audit.log | audit2allow -M nginx
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i nginx.pp

[root@localhost user]# semodule -i nginx.pp
[root@localhost user]# systemctl restart nginx

 nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)
     Active: active (running) since Wed 2025-10-22 12:19:12 MSK; 8s ago
    Process: 16064 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 16065 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 16066 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 16067 (nginx)
      Tasks: 3 (limit: 10602)
     Memory: 2.8M
        CPU: 40ms
     CGroup: /system.slice/nginx.service
             ├─16067 "nginx: master process /usr/sbin/nginx"
             ├─16068 "nginx: worker process"
             └─16069 "nginx: worker process"
